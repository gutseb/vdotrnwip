---
- name: debug out organization
  debug:
    var: organization
    verbosity: 1

- name: "ORG: {{ organization.id }} {{ organization.name }} : Create directory for organization {{ organization.name }} artifacts"
  file:
    path: "{{ git_root_dir.path }}/repo/managed/organizations/{{ organization.name }}"
    state: directory

- name: "ORG: {{ organization.id }} {{ organization.name }} : Create organization configuration."
  copy:
    content: "{{ organization | to_nice_yaml(width=6553600) }}"
    dest: "{{ git_root_dir.path }}/repo/managed/organizations/{{ organization.name }}.yaml"

- name: "ORG: {{ organization.id }} {{ organization.name }} : Artifact Type Loop"
  include_tasks: artifact_block.yml
  loop:
    - name: repositories
      get_individual_records: true
      is_katello: true
      is_virt_who: false
      unique_key: name
    - name: products
      get_individual_records: true
      is_katello: true
      is_virt_who: false
      unique_key: name
    - name: activation_keys
      get_individual_records: true
      is_katello: true
      is_virt_who: false
      unique_key: name
    - name: content_credentials
      is_katello: true
      is_virt_who: false
      unique_key: name
    - name: content_views
      is_katello: true
      is_virt_who: false
      unique_key: name
    - name: environments # lifecycle env
      is_katello: true
      is_virt_who: false
      unique_key: name
    - name: sync_plans
      is_katello: true
      is_virt_who: false
      unique_key: name
    - name: configs # virt-who
      is_katello: false
      is_virt_who: true
      unique_key: name
    - name: auth_source_ldaps #ldap sync
      is_katello: false
      is_virt_who: false
      unique_key: name
    - name: users
      is_katello: false
      is_virt_who: false
      unique_key: login
    - name: subscriptions
      is_katello: true
      is_virt_who: false
      unique_key: name
    - name: host_collections 
      get_invdividual_records: true
      is_katello: true
      is_virt_who: false
      unique_key: name
  loop_control:
    loop_var: artifact_type
